{"author":{"id":"MDQ6VXNlcjk0MDUz","is_bot":false,"login":"trobrock","name":"Trae Robrock"},"body":"I was setting up the github mcp and (for some still unknown reason) it's returning a permissions error. When using OpenAI, I see the permissions error, but when using Claude I see this:\n\n```\n2025-03-10T21:05:22.625757Z ERROR goose::agents::truncate: Error: Request failed: Request failed with status: 400 Bad Request. Message: messages.35: Messages containing `tool_use` blocks must be followed by a user message with `tool_result` blocks\n    at crates/goose/src/agents/truncate.rs:396\n\nRan into this error: Request failed: Request failed with status: 400 Bad Request. Message: messages.35: Messages containing `tool_use` blocks must be followed by a user message with `tool_result` blocks.\n\nPlease retry if you think this is a transient or recoverable error.\n```\n\nNo other prompts succeed after hitting this and I have to close the CLI.\n\n\n**To Reproduce**\nSteps to reproduce the behavior:\n1. Set your config:\n```\nGOOSE_PROVIDER: anthropic\nGOOSE_MODEL: claude-3-7-sonnet-latest\nextensions:\n  github:\n    args:\n    - -y\n    - '@modelcontextprotocol/server-github'\n    cmd: npx\n    enabled: true\n    envs: {}\n    name: github\n    timeout: 300\n    type: stdio\n```\n2. Do not set a github auth token\n3. Make a prompt like \"Tell me about this github issue https://github.com/block/fakerepo/issues/1102\"\n\n**Expected behavior**\nShow the error like the OpenAI provider does:\n```\nExecution failed: RPC error: code=-32603, message=Not Found: Resource not found: Not Found\nIt seems that the GitHub issue you mentioned does not exist or the repository `block/fakerepo` could not be found. Please make sure the repository and issue number are correct, or check if the repository is private and requires appropriate access permissions.\n```\n\nThe CLI should still be usable after the error.\n\n**Screenshots**\nIf applicable, add screenshots to help explain your problem.\n\n**Please provide following information:**\n - **OS & Arch:** Mac OSX\n - **Interface:** CLI\n - **Version:** v1.0.12\n - **Extensions enabled:** developer, fetch, github, stripe\n - **Provider & Model:** [e.g. Google - gemini-1.5-pro]\n\n**Additional context**\nAdd any other context about the problem here.\n","comments":[{"id":"IC_kwDOMneZ986h3wny","author":{"login":"wendytang"},"authorAssociation":"COLLABORATOR","body":"Related #1624 - error handling: tool call errors shouldn't take down the entire session, we should provide a way to recover ","createdAt":"2025-03-11T21:29:00Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/block/goose/issues/1600#issuecomment-2715748850","viewerDidAuthor":true}],"createdAt":"2025-03-10T21:18:02Z","labels":[{"id":"LA_kwDOMneZ988AAAABtyYvtQ","name":"bug","description":"Something isn't working","color":"B2E3B4"}],"number":1600,"state":"OPEN","title":"CLI becomes broken after a tool returns an error when using Claude","url":"https://github.com/block/goose/issues/1600"}
